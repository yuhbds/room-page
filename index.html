<script>
  async function createRoom() {
    const nickname = document.getElementById("nickname").value.trim();
    if (!nickname) return alert("请输入昵称");

    try {
      const res = await fetch("https://ydhb.onrender.com/create-room", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({})  // 修正这里！
      });
      const data = await res.json();
      if (data.room_id) {
        alert("创建成功，房间号：" + data.room_id);
        document.getElementById("roomId").value = data.room_id;
      } else {
        alert("创建失败");
      }
    } catch (err) {
      alert("创建失败，请检查网络");
    }
  }

  async function joinRoom() {
    const nickname = document.getElementById("nickname").value.trim();
    const roomId = document.getElementById("roomId").value.trim();
    if (!nickname || !roomId) return alert("请输入昵称和房间号");

    try {
      const res = await fetch("https://ydhb.onrender.com/join-room", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ room_id: roomId })
      });
      const data = await res.json();
      if (data.message && data.message.includes("Joined")) {
        window.location.href = `wlgame://room?room_id=${roomId}&name=${encodeURIComponent(nickname)}`;
      } else {
        alert(data.message || "加入失败");
      }
    } catch (err) {
      alert("加入失败，请检查网络");
    }
  }
</script>
